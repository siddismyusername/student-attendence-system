<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management System - Login</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="login-box">
            <h1>Attendance Management System</h1>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('admin')">Admin</button>
                <button class="tab-btn" onclick="switchTab('teacher')">Teacher</button>
                <button class="tab-btn" onclick="switchTab('student')">Student</button>
            </div>

            <!-- Admin Login -->
            <div id="admin-tab" class="tab-content active">
                <h2>Admin Login</h2>
                <form id="admin-form" onsubmit="handleLogin(event, 'admin')">
                    <div class="form-group">
                        <label for="admin-email">Email</label>
                        <input type="email" id="admin-email" required placeholder="admin@school.com">
                    </div>
                    <div class="form-group">
                        <label for="admin-password">Password</label>
                        <input type="password" id="admin-password" required placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn">Login</button>
                </form>
            </div>

            <!-- Teacher Login -->
            <div id="teacher-tab" class="tab-content">
                <h2>Teacher Login</h2>
                <form id="teacher-form" onsubmit="handleLogin(event, 'teacher')">
                    <div class="form-group">
                        <label for="teacher-email">Email</label>
                        <input type="email" id="teacher-email" required placeholder="teacher@school.com">
                    </div>
                    <div class="form-group">
                        <label for="teacher-password">Password</label>
                        <input type="password" id="teacher-password" required placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn">Login</button>
                </form>
            </div>

            <!-- Student Login -->
            <div id="student-tab" class="tab-content">
                <h2>Student Login</h2>
                <form id="student-form" onsubmit="handleLogin(event, 'student')">
                    <div class="form-group">
                        <label for="student-email">Email</label>
                        <input type="email" id="student-email" required placeholder="student@school.com">
                    </div>
                    <div class="form-group">
                        <label for="student-password">Password</label>
                        <input type="password" id="student-password" required placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn">Login</button>
                </form>
            </div>

            <div id="error-message" class="error-message"></div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        function switchTab(role) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(role + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Clear error message
            document.getElementById('error-message').textContent = '';
        }

        async function handleLogin(event, role) {
            event.preventDefault();

            const email = document.getElementById(role + '-email').value;
            const password = document.getElementById(role + '-password').value;
            const errorMsg = document.getElementById('error-message');

            try {
                const response = await API.login(role, email, password);

                if (response.success) {
                    // Store user data in sessionStorage
                    sessionStorage.setItem('user', JSON.stringify(response.data));
                    
                    // Redirect to appropriate dashboard
                    window.location.href = role + '.html';
                } else {
                    errorMsg.textContent = response.error || 'Login failed';
                }
            } catch (error) {
                errorMsg.textContent = 'Connection error. Please try again.';
                console.error('Login error:', error);
            }
        }
    </script>
</body>
</html>
